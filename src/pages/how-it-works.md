---
sidebar_position: 8
---

# How it Works

1. `vovk dev` finds the closest available port to run Next.js server by itself. This is an important step that allows Vovk Metadata Server to know the `process.env.PORT` and Next.js dev server to know `process.env.VOVK_PORT`. If `VOVK_PORT` is not set the library going to add a magic number to `PORT` value. This is the only purpose of this wrapper around the standard `next dev` command.
1. When available port is found Vovk runs two processes (similar to [concurrently](https://www.npmjs.com/package/concurrently)) in parallel: Vovk Metadata Server and the regular `next dev`.
1. Each time when an endpoint is requested in dev mode, `initVovk` is initialised again and it POSTs information about controllers and workers to the Vovk Metadata Server. Previous major version of Vovk.ts used `fs` Node.js module to write metadata file but this approach didn't work in Edge Runtime since most of the standard Node.js capabilities can't be used this environment. Instead of `fs` Vovk.ts starts its own server that accepts the required via POST request made by `initVovk` function. In production `initVovk` is called once for each instance of the application to initialise controllers and doesn't perform actions described on this page.
1. The Metadata Server accepts this data and if a change is detected it updates **.vovk.json** and **node_modules/.vovk** (it contains the generated client) automatically. By Next.js design endpoints handled by [Optional Catch-all Segment](https://nextjs.org/docs/pages/building-your-application/routing/dynamic-routes#optional-catch-all-segments) execute its code each time when the endpoint is requested.
1. To make development process seamless and to trigger file creation without calling any endpoint manually, Vovk Metadata Server constrantly pings `GET /api/__ping` every 3 seconds to make the client regenerated automatically.
1. If metadata is changed, the Metadata Server regenerates **.vovk.json** and files ay **node_modules/.vovk** that contains **.js** and **.d.ts** files for the client. Vovk.ts doesn't watch files and doesn't use AST to build the client making client generating to perform instantly considering the short ping delay.