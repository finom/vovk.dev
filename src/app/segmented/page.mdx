import { FileTree } from 'nextra/components';

# Segmented RPC Client

The [Composed RPC Client](/composed) is suitable for single-page applications, but in larger applications, exposing the schema for all segments in a single RPC client isn't always desirable. In this case, with a simple configuration change, you can instruct Vovk.ts to generate separate RPC clients for each segment. This approach is called the **"Segmented RPC Client"** and allows you to split the client into smaller TypeScript files that can be imported separately, hiding RPC modules and their corresponding schemas from specific pages. For example, pages responsible for "customer" functionality won't import "admin" RPC modules, keeping admin implementation details hidden from customer pages.

By default, the segmented client is generated into the **./src/client** folder (or **./client** folder if you don't use a src folder) from the [ts](/templates#ts) template. For an app with multiple segments, the structure of the generated client may look like this:

<FileTree>
  <FileTree.Folder name="src/client" defaultOpen>
    <FileTree.Folder name="root" defaultOpen>
      <FileTree.File
        name={
          <span>
            index.ts{' '}
            <span className="text-gray-500">
              (imports <code>./schema.ts</code> and <code>./openapi.ts</code>)
            </span>
          </span>
        }
      />
      <FileTree.File
        name={
          <span>
            schema.ts{' '}
            <span className="text-gray-500">
              (imports <code>.vovk-schema/root.json</code>)
            </span>
          </span>
        }
      />
      <FileTree.File
        name={
          <span>
            openapi.json{' '}
            <span className="text-gray-500">
              (root segment OpenAPI schema)
            </span>
          </span>
        }
      />
       <FileTree.File
        name={
          <span>
            openapi.ts{' '}
            <span className="text-gray-500">
              (imports <code>./openapi.json</code>)
            </span>
          </span>
        }
      />
    </FileTree.Folder>
    <FileTree.Folder name="admin" defaultOpen>
      <FileTree.File
        name={
          <span>
            index.ts{' '}
            <span className="text-gray-500">
              (imports <code>./schema.ts</code> and <code>./openapi.ts</code>)
            </span>
          </span>
        }
      />
      <FileTree.File
        name={
          <span>
            schema.ts{' '}
            <span className="text-gray-500">
              (imports <code>.vovk-schema/admin.json</code>)
            </span>
          </span>
        }
      />
      <FileTree.File
        name={
          <span>
            openapi.json{' '}
            <span className="text-gray-500">
              (admin segment OpenAPI schema)
            </span>
          </span>
        }
      />
       <FileTree.File
        name={
          <span>
            openapi.ts{' '}
            <span className="text-gray-500">
              (imports <code>./openapi.json</code>)
            </span>
          </span>
        }
      />
    </FileTree.Folder>
    <FileTree.Folder name="customer" defaultOpen>
      <FileTree.File
        name={
          <span>
            index.ts{' '}
            <span className="text-gray-500">
              (imports <code>./schema.ts</code> and <code>./openapi.ts</code>)
            </span>
          </span>
        }
      />
      <FileTree.File
        name={
          <span>
            schema.ts{' '}
            <span className="text-gray-500">
              (imports <code>.vovk-schema/customer.json</code>)
            </span>
          </span>
        }
      />
      <FileTree.File
        name={
          <span>
            openapi.json{' '}
            <span className="text-gray-500">
              (customer segment OpenAPI schema)
            </span>
          </span>
        }
      />
       <FileTree.File
        name={
          <span>
            openapi.ts{' '}
            <span className="text-gray-500">
              (imports <code>./openapi.json</code>)
            </span>
          </span>
        }
      />
      <FileTree.Folder name="static" defaultOpen>
        <FileTree.File
          name={
            <span>
              index.ts{' '}
              <span className="text-gray-500">
                (imports <code>./schema.ts</code> and <code>./openapi.ts</code>)
              </span>
            </span>
          }
        />
        <FileTree.File
          name={
            <span>
              schema.ts{' '}
              <span className="text-gray-500">
                (imports <code>.vovk-schema/customer/static.json</code>)
              </span>
            </span>
          }
        />
        <FileTree.File
          name={
            <span>
              openapi.json{' '}
              <span className="text-gray-500">
                (customer static sub-segment OpenAPI schema)
              </span>
            </span>
          }
        />
         <FileTree.File
          name={
            <span>
              openapi.ts{' '}
              <span className="text-gray-500">
                (imports <code>./openapi.json</code>)
              </span>
            </span>
          }
        />
      </FileTree.Folder>
    </FileTree.Folder>
  </FileTree.Folder>
</FileTree>

When you import an RPC module from one of the `.ts` files, the import tree will contain only the schema for that segment and the RPC modules used in that segment. For example, if you import `UserRPC` from the `customer` segment, the import tree will contain only the schema for the `customer` segment located at `.vovk-schema/customer.json` and the RPC modules used in that segment. `.vovk-schema/admin.json` and other JSON files for other segments won't be included in the import tree.

```ts filename="src/client/customer/index.ts"
import { UserRPC } from '@/client/customer'; // import tree will contain customer.json

await UserRPC.getUser({ id: '123' });
```

The segmented client is also applicable for [Rust](/rust) and [Python](/python) templates, though it has an unknown use case.

In order to enable the segmented client, you need to set the `segmentedClient.enabled` option to `true` in the `vovk.config.mjs` file and optionally disable the composed client by setting `composedClient.enabled` to `false`.

```ts filename="vovk.config.mjs"
/** @type {import('vovk').VovkConfig} */
const config = {
  segmentedClient: {
    enabled: true,
  },
  composedClient: {
    enabled: false,
  },
};
export default config;
```

At this case the **vovk-client** package isn't needed anymore.

The settings are the same as the settings for the [composed client](/composed).

```ts filename="vovk.config.mjs"
/** @type {import('vovk').VovkConfig} */
const config = {
  segmentedClient: {
    enabled: false, // default
    fromTemplates: ['ts'], // default
    outDir: './src/client', // default
    includeSegments: ['foo'], // exclusive with `excludeSegments`
    excludeSegments: ['bar'], // exclusive with `includeSegments`
  },
};
```

