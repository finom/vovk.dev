# Client Templates

## Introduction

Vovk.ts renders client libraries from [EJS](https://www.npmjs.com/package/ejs) templates. To accommodate a wide range of use cases, Vovk.ts provides simple yet powerful template logic that meets the following requirements:

1. Render multiple files from a single template definition. This means a **"template" is a directory** with one or more files, where files with the `.ejs` extension are rendered as EJS templates and other files are copied as-is. An `index.ts.ejs` file is rendered as `index.ts`, and an `index.ts` without the `.ejs` extension is copied as-is.
2. Use existing templates as a base for other templates using the `extends` option. This allows to create a new template that extends an existing one and overrides some of its options.
3. Use existing templates as dependencies for other templates using the `requires` option. This allows to create a new template that composes existing templates and renders them into the output directory.

Template definitions are configured in [config](/config) under the `clientTemplateDefs` option. By default, this object includes built-in template definitions that become visible if you set [`exposeConfigKeys`](/config#exposeConfigKeys) to `true` or, if `exposeConfigKeys` is an array, add `clientTemplateDefs`. You can then inspect `.vovk-schema/_meta.json`, which lists all available template definitions under `config`.

## Example

To make the options in the next section concrete, let‚Äôs break down the built-in template definition for the [Rust client](/rust). The primary definition is stored under the [rs](#rs) key, which is the template name used in the [segmented client](/segmented) or [composed client](/composed) configuration.

By itself, the `rs` template doesn‚Äôt contain files, so it omits `templatePath`. Instead, it requires:

- the [rsSrc](#rssrc) definition that renders Rust source files to `./src` (relative to `outDir`)
- the [rsPkg](#rspkg) definition that renders Cargo-related files to the root of `outDir`, 
- and the [rsReadme](#rsreadme) definition that renders README files to the root of `outDir`.

 The `rs` template definition also sets a `composedClient` option that overrides the default `outDir` to `dist_rust`, so it isn‚Äôt compiled into the `node_modules/.vovk-client` folder used by the composed [TypeScript](/typescript) client.

The [rsSrc](#rssrc) definition uses `templatePath` to point to its template directory (`lib.rs.ejs`, `http_request.rs`, etc.). It `requires` the [schemaJson](#schemajson) template that renders `schema.json`, which combines the full schema from the `.vovk-schema/` folder.

Let's simulate how you would define this setup in your own `vovk.config.mjs` file.

```ts showLineNumbers copy filename="vovk.config.mjs"
/** @type {import('vovk').VovkConfig} */
const config = {
  clientTemplateDefs: {
    schemaJson: {
      templatePath: `vovk-cli/client-templates/schemaJson/`,
    },
    rsSrc: {
      templatePath: `vovk-rust/client-templates/rsSrc/`,
      requires: {
        schemaJson: './',
      },
    },
    rsPkg: {
      templatePath: `vovk-rust/client-templates/rsPkg/`,
    },
    rsReadme: {
      templatePath: `vovk-rust/client-templates/rsReadme/`,
    },
    rs: {
      composedClient: {
        outDir: 'dist_rust',
      },
      requires: {
        rsSrc: './src/',
        rsPkg: './',
        rsReadme: './',
      },
    },
  }
};

export default config;
```

(all paths end with a slash `/` for clarity, though it isn‚Äôt required)

This setup allows you to generate the full Cargo package with:

```sh npm2yarn copy
npx vovk generate --from rs --out ./dist_rust
```

Or generate only the source code with:

```sh
npx vovk generate --from rsSrc --out ./my_rust_project/src
```

Or only the `README.md` file with:

```sh npm2yarn copy
npx vovk generate --from rsReadme --out ./my_rust_project
```

<a name="defs" />
## Template Definitions

The available options:

<a name="extends" />
### `extends?: string`

Specifies the name of the built-in template this definition extends. Use `extends` to inherit and override options, such as `segmentedClient.outDir`.

<a name="templatePath" />
### `templatePath?: string`

Path to the template directory, relative to the project root. If omitted, the template can still use [requires](#requires) to include files from other templates.

<a name="requires" />
### `requires?: Record<string, string>`

Other template definitions this template depends on. Keys are template names; values are target paths where those templates will be rendered, relative to the output directory root.

<a name="composedClient" />
### `composedClient?: object`

Options for the composed client that extend the root `composedClient` options in [config](/config). Use this to customize behavior for this template (e.g., `outDir`, `excludeSegments`, etc.).

<a name="segmentedClient" />
### `segmentedClient?: object`

Options for the segmented client that extend the root `segmentedClient` options in [config](/config). Use this to customize behavior for this template (e.g., `outDir`, `excludeSegments`, etc.).

<a name="outputconfig" />
### `outputConfig?: object`

Overrides `outputConfig` in the root [config](/config#outputconfig). Use this to customize the generated client (e.g., `origin`, `openAPIObject`, etc.).

## Built-in Templates


### `ts`

Used as the default template for the [segmented client](/segmented). Renders TypeScript code.

- `requires` [tsBase](#tsbase), [openapiTs](#openapits).

### `js`

Used as a default template for the [composed client](/composed). Renders ES Module code.

- `requires` [jsBase](#jsbase), [openapiJs](#openapijs).

### `tsBase`

Used as the default template for the [bundle](/bundle) as it doesn't include `openapi` object. Renders TypeScript code.

- `templatePath` is `vovk-cli/client-templates/tsBase/`.
- `requires` [schemaTs](#schemats), [mixins](#mixins) (the last one is used conditionally if [OpenAPI mixins](/mixins) are used).

### `jsBase`

Renders ES Module code.

- `templatePath` is `vovk-cli/client-templates/jsBase/`.
- `requires` [schemaJs](#schemajs), [mixins](#mixins) (the last one is used conditionally if OpenAPI mixins are used).

### `schemaTs`

Renders the `schema.ts` file that imports the schema of available segments from the `.vovk-schema/` folder and re-exports it as a TypeScript object.

- `templatePath` is `vovk-cli/client-templates/schemaTs/`.

### `schemaJs`

Renders the `schema.js` and `schema.d.ts` files that import the schema of available segments from the `.vovk-schema/` folder and re-export it as an ES Module.

- `templatePath` is `vovk-cli/client-templates/schemaJs/`.

### `schemaJson`

Renders the `schema.json` file that contains the full schema of all segment schemas combined from the `.vovk-schema/` folder for the composed client, or of a single segment schema for the segmented client.

- `templatePath` is `vovk-cli/client-templates/schemaJson/`.

### `openapiTs`

Renders the `openapi.ts` file that re-exports the OpenAPI schema located in the `openapi.json` file (provided by the [openapiJson](#openapijson) template) in the same folder.

- `templatePath` is `vovk-cli/client-templates/openapiTs/`.
- `requires` [openapiJson](#openapijson) template to import the OpenAPI schema in the generated code.

### `openapiJs`

Renders the `openapi.js` and `openapi.d.ts` files that re-export the OpenAPI schema located in the `openapi.json` file (provided by the [openapiJson](#openapijson) template) in the same folder.

- `templatePath` is `vovk-cli/client-templates/openapiJs/`.
- `requires` [openapiJson](#openapijson) template to import the OpenAPI schema in the generated code.

### `openapiJson`

Renders the `openapi.json` file that contains the OpenAPI schema. Can be used separately if you need to provide the OpenAPI schema in your project.

- `templatePath` is `vovk-cli/client-templates/openapiJson/`.

### `readme`

Renders the `README.md` file that contains the generated [TypeScript](/typescript) client documentation. It's rendered from data provided in the `package.json` file, whose properties can be overridden in the `bundle`, `composedClient`, or `segmentedClient` options in the [config](/config) file, at the root level or on the template definition level. Each method is documented as code, providing self-documented code examples for each RPC method that can be copied directly to your codebase.

- `templatePath` is `vovk-cli/client-templates/readme/`.

### `packageJson`

Renders the `package.json` file that makes the generated client ready to be published to NPM. It includes the `name`, `version`, `description`, and `repository` taken from the root `package.json`, and other `package` fields that can be overridden in the `bundle`, `composedClient`, or `segmentedClient` options in the [config](/config) file, at the root level or on the template definition level.

- `templatePath` is `vovk-cli/client-templates/packageJson/`.

### `mixins`

Generates types and [schema](/schema) for [OpenAPI mixins](/mixins) when they are present.

- `templatePath` is `vovk-cli/client-templates/mixins/`.

### `rs`

Renders the [Rust](/rust) client package that includes both source code and Cargo files.

- `requires` [rsSrc](#rssrc) and [rsPkg](#rspkg) templates.
- Defines a `composedClient` option to set the output directory to `dist_rust`.
- `extends` [rsSrc](#rssrc) and [rsPkg](#rspkg) templates.

### `rsSrc`

Renders [Rust](/rust) client source code files, such as `lib.rs`, `http_request.rs`, etc.

- `templatePath` is `vovk-rust/client-templates/rsSrc/`.
- `requires` [schemaJson](#schemajson) template to include the full schema in the generated code.

### `rsPkg`

Renders `Cargo.toml` and `README.md` files for the Rust client.

- `templatePath` is `vovk-rust/client-templates/rsPkg/`.
- `requires` [rsReadme](#rsreadme) template to include the README file in the package.

### `rsReadme`

Renders the `README.md` file for the Rust client. Works similarly to the [readme](#readme) template.

- `templatePath` is `vovk-rust/client-templates/rsReadme/`.

### `py`

Renders the Python client package that includes both source code and setup files.

- `requires` [pySrc](#pysrc) and [pyPkg](#pypkg) templates.
- Defines a `composedClient` option to set the output directory to `dist_python`.
- `extends` [pySrc](#pysrc) and [pyPkg](#pypkg) templates.

### `pySrc`

Renders [Python](/python) client source code files, such as `__init__.py`, `http_request.py`, etc.
- `templatePath` is `vovk-python/client-templates/pySrc/`.
- `requires` [schemaJson](#schemajson) template to include the full schema in the generated code.

### `pyPkg`
Renders `setup.py`, `pyproject.toml`, and `README.md` files for the Python client.
- `templatePath` is `vovk-python/client-templates/pyPkg/`.
- `requires` [pyReadme](#pyreadme) template to include the README file in the package.

### `pyReadme`
Renders the `README.md` file for the Python client. Works similarly to the [readme](#readme) template.
- `templatePath` is `vovk-python/client-templates/pyReadme/`.


## Roadmap

- üìù Describe creation of custom templates.
