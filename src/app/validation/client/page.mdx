import { Tabs } from 'nextra/components';

# Client-Side Validation for RPC Methods

The [schema](/schema) emitted by the server-side code is primarily used to build the RPC modules, but as an implementation side-effect, it can also be used for client-side validation. The client-side validation library is defined by hooking into the RPC module template via the [validateOnClient](/imports#validateonclient) import.

```ts filename="vovk.config.mjs"
/** @type {import('vovk').VovkConfig} */
const config = {
  outputConfig: {
    imports: {
      validateOnClient: 'my-client-validation-library',
    },
  }
};

export default config;
```

This will affect the generated RPC modules to import the given client-side validation library.

```ts filename="./node_modules/.vovk-client/index.mjs"
// ...
export const UserRPC = createRPC(
  schema, '', 'UserRPC', import('vovk'),
  { validateOnClient: import('my-client-validation-library') }
);
```

## vovk-ajv

[vovk-ajv](https://www.npmjs.com/package/vovk-ajv) is the primary library that implements client-side validation using [Ajv](https://www.npmjs.com/package/ajv). It is installed and set up automatically when `npx vovk-init` is used. **vovk-ajv** supports additional configuration listed as `config.libs.ajv` in the [vovk.config](/config) file, such as Ajv options, localization, and target version of the JSON schema.

```bash npm2yarn
npm install vovk-ajv@draft
```

```ts filename="vovk.config.mjs"
/** @type {import('vovk').VovkConfig} */
const config = {
  imports: {
    validateOnClient: 'vovk-ajv',
  },
  libs: {
    /** @type {import('vovk-ajv').VovkAjvConfig} */
    ajv: {
      options: {
        // Ajv options
        strict: false,
      },
      localize: 'en', // language supported by "ajv-i18n"
      target: 'draft-07', // auto-detected from $schema but can be configured
    },
  },
};
export default config;
```

## vovk-dto/validateOnClient

When using [class-validator](/validation/dto) for server-side validation, you can use the same DTOs to validate client-side requests. For more information, see the [DTO client-side validation](/validation/dto#validateonclient) section.

## Custom Client-Side Validation

A custom `validateOnClient` function can be implemented with the `createClientValidation` function, which accepts a `validate` option. This option, in turn, accepts the input data, validation schema, and some extra information about the request. The `validate` function should return the validated input data or throw an error if validation fails. It can optionally throw `HttpException` with status `0` as the default behavior for failed client-side validation. The `meta` object contains information about the request, such as `type`, `endpoint`, etc. 

```ts
import { createValidateOnClient, HttpException, HttpStatus } from 'vovk';

export const validateOnClient = createValidateOnClient({
  validate: async (input, schema, meta) => {
    try {
      return myValidateFunction(input, schema, meta);
    } catch (error) {
      throw new HttpException(HttpStatus.NULL, `Custom validation failed: ${error.message}`);
    }
  },
});
```

## FormData

As there is no standard way to describe `FormData` in JSON Schema, every validation library must provide its own way to generate an OAS-compatible schema for `FormData` requests.

```json {6}
{
  "type": "object",
  "properties": {
    "fileField": {
      "type": "string",
      "format": "binary"
    }
  },
}
```

Zod 4 includes a `.file()` schema that is converted to a valid [OAS schema](https://zod.dev/json-schema?id=file-schemas), but for other libraries, this needs to be solved individually. This is outlined for every library mentioned in this documentation (for ArkType, it's solved by using a `fallback`; for Valibot, you need to use `overrideSchema`, etc.).

---

If you use a library that isn't mentioned here and you don't know how to make it properly generate the OAS file schema, the easiest workaround is to use the `disableClientValidation` option in the generated RPC modules:

```ts
import { UserRPC } from 'vovk-client';

const respData = await UserRPC.updateUser({
  body: formData, // FormData instance
  params: { id: '...' },
  disableClientSideValidation: true, // disable client-side validation
});
```

This way, client-side validation will be skipped, but server-side validation will still be performed. The file will not appear in the generated OpenAPI specification, but the endpoint will still accept `multipart/form-data` requests.