# Standard Schema Validation

[Standard Schema](https://github.com/standard-schema/standard-schema) is a convention supported by modern validation libraries that implements a common interface for defining and validating data structures. It's supported by libraries like [Zod 4](https://www.npmjs.com/package/zod), [ArkType](https://www.npmjs.com/package/arktype), [Valibot](https://www.npmjs.com/package/valibot), and many others. Check the full list of libraries that implement Standard Schema [at the original repository](https://github.com/standard-schema/standard-schema?tab=readme-ov-file#what-schema-libraries-implement-the-spec).

Vovk.ts provides a simple `createStandardValidation` function that creates a custom validation library using Standard Schema. The only option for this function is the `toJSONSchema` function, which defines how to convert the models to JSON Schema format.

## ArkType Example

Create `withArk` somewhere in your codebase:

```ts filename="src/lib/withArk.ts"
import { createStandardValidation } from 'vovk';
import type { type } from 'arktype';

const withArk = createStandardValidation({
  toJSONSchema: (model: type) => model.toJsonSchema({
    fallback: { 
      proto: (ctx) => ctx.proto === File ? {
        type: "string",
        format: "binary",
      } : ctx.base,
      default: (ctx) => ctx.base
    }
  })
});
```

Then use it in your controller:

```ts filename="src/modules/user/UserController.ts"
import { prefix, post, operation } from 'vovk';
import { type } from 'arktype';
import { withArk } from '@/lib/withArk';

@prefix('users')
export default class UserController {
  @operation({
    summary: 'Update user (Arktype)',
    description: 'Update user by ID with Arktype validation',
  })
  @post('{id}')
  static updateUser = withArk({
    body: type({
      name: type('string').describe('User full name'),
      age: type('0 < number < 120').describe('User age'),
      email: type('string.email').describe('User email'),
    }),
    params: type({
      id: type('string.uuid').describe('User ID'),
    }),
    query: type({
      notify: type('"email" | "push" | "none"').describe('Notification type'),
    }),
    output: type({
      success: type('boolean').describe('Success status'),
    }),
    async handle(req, { id }) {
      const { name, age } = await req.json();
      const notify = req.nextUrl.searchParams.get('notify');

      // do something with the data
      console.log(`Updating user ${id}:`, { name, age, notify });
      return {
        success: true,
      };
    },
  });
}
```

## Valibot Example

Create `withValibot` somewhere in your codebase:

```ts filename="src/lib/withValibot.ts"
import { createStandardValidation } from 'vovk';
import { toJsonSchema } from '@valibot/to-json-schema';

const withValibot = createStandardValidation({
  toJSONSchema: (model) => toJsonSchema(model, {
    overrideSchema(context) {
      if (context.valibotSchema.type === 'file') {
        return { type: 'string', format: 'binary' };
      }
    },
  }),
});
```

Then use it in your controller:

```ts filename="src/modules/user/UserController.ts"
import { prefix, post, operation } from 'vovk';
import * as v from 'valibot';
import { withValibot } from '@/lib/withValibot';

@prefix('users')
export default class UserController {
  @operation({
    summary: 'Update user (Valibot)',
    description: 'Update user by ID with Valibot validation',
  })
  @post('{id}')
  static updateUser = withValibot({
    body: v.pipe(
      v.object({
        name: v.pipe(v.string(), v.description('User full name')),
        age: v.pipe(v.number(), v.minValue(0), v.maxValue(120), v.description('User age')),
        email: v.pipe(v.string(), v.email(), v.description('User email')),
      }),
      v.description('User object')
    ),
    params: v.object({
      id: v.pipe(v.string(), v.uuid(), v.description('User ID')),
    }),
    query: v.object({
      notify: v.pipe(v.picklist(['email', 'push', 'none']), v.description('Notification type')),
    }),
    output: v.pipe(
      v.object({
        success: v.pipe(v.boolean(), v.description('Success status')),
      }),
      v.description('Response object')
    ),
    async handle(req, { id }) {
      const { name, age } = await req.json();
      const notify = req.nextUrl.searchParams.get('notify');

      // do something with the data
      console.log(`Updating user ${id}:`, { name, age, notify });
      return {
        success: true,
      };
    },
  });
}
```

All other libraries are implemented in a similar way; the only difference may be in the `toJSONSchema` implementations. Once [standard-schema/issues/21](https://github.com/standard-schema/standard-schema/issues/21) is resolved, the requirement to use `createStandardValidation` will likely become obsolete in most cases.
