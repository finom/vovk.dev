import { Tabs } from 'nextra/components'
import BasicService from '../../downloaded-examples/basic-with-service/BasicService.mdx';
import BasicControllerWithService from '../../downloaded-examples/basic-with-service/BasicControllerWithService.mdx';
import BasicExampleWithService from '../../downloaded-examples/basic-with-service/BasicExampleWithService.mdx';
import LiveBasicExampleWithService from '../live-examples/LiveBasicExampleWithService';

# Service class

In order to make the code cleaner it's recommended to move most of the logic to a service. "Service" is a static class that serves as a library that performs database and third-party API calls.

Let's say you have the following Controller Class:

```ts filename="/src/modules/user/UserController.ts"
import { prefix, put, type VovkRequest } from 'vovk';
import type { User } from '../../types';

@prefix('users')
export default class UserController {
    @put(':id') 
    static async updateUser(req: VovkRequest<Partial<User>>, { id }: { id: string }) {
        const data = await req.json();

        const updatedUser = await prisma.user.update({
            where: { id },
            data,
        });

        return updatedUser;
    }
}
```

Currently it looks fine since it doesn't contain a lot of logic. But as your app is getting more complex you're going to get more endpoints with more code. At this case it's recommended to move part of the logic to a service class making controllers to be responsible for input extraction, validation and authorisation, but not for DB or API calls.

```ts filename="/src/modules/user/UserService.ts"

// ... import types and libraries ...

export default class UserService {
    static updateUser(id: string, data: Partial<User>) {
        return prisma.user.update({
            where: { id },
            data,
        });
    }
}
```

As you can see, `UserService` does not use decorators and used as a library that performs required side-effects.

```ts filename="/src/modules/user/UserController.ts"
import { prefix, put, type VovkRequest } from 'vovk';
import UserService from './UserService'

@prefix('users')
export default class UserController {
    @put(':id') 
    static async updateUser(req: VovkRequest<Partial<User>>, { id }: { id: string }) {
        const data = await req.json();
        return UserService.updateUser(id, data);
    }
}
```

Services can use other services as well. You can also create as many services as you need for a single controller.

```ts filename="/src/modules/user/UserService.ts"
import PostService from '../post/PostService';
import CommentService from '../comment/CommentService';
// ... other imports ...

export default class UserService {
    static async updateUser(id: string, data: Partial<User>) {
        const latestPost = PostService.findLatestUserPost(id);
        const latestPostComments = CommentService.findPostComments(latestPost.id);
        // ...
    }
}
```

## Extracting types from the controller

Thanks to [Anders Hejlsberg
](https://github.com/ahejlsberg) for a solution for [#58616](https://github.com/microsoft/TypeScript/issues/58616). A tiny fix in TypeScript language allows to use circular type references in service-controller pair, making contrtoller types such as body, query and params to be available in the service.

```ts filename="/src/modules/user/UserController.ts"
import { prefix, put, type VovkRequest } from 'vovk';
import type { User } from '../../types';

@prefix('users')
export default class UserController {
    @put(':id') 
    static async updateUser(req: VovkRequest<Partial<User>, { role: 'string' }>, { id }: { id: string }) {
        const data = await req.json();
        return UserService.updateUser(id, data, req.nextUrl.searchParams.get('role'));
    }
}
```

```ts filename="/src/modules/user/UserService.ts"
import type { VovkControllerBody, VovkControllerQuery, VovkControllerParams } from 'vovk';
import type { User } from '../../types';
import type UserController from './UserController';

export default class UserService {
    static async updateUser(
        id: VovkControllerParams<typeof UserController.updateUser>['id'], 
        data: VovkControllerBody<typeof UserController.updateUser>, 
        role: VovkControllerQuery<typeof UserController.updateUser>['role']
    ) {
        // ...
    }
}
```

See more types at the [type extraction docs](/controller/type-extraction).

## Live example

<div className="doc-live-example">
<LiveBasicExampleWithService />
</div>
<Tabs items={['Service', 'Controller', 'Component']}>
  <Tabs.Tab><BasicService /></Tabs.Tab>
  <Tabs.Tab><BasicControllerWithService /></Tabs.Tab>
  <Tabs.Tab><BasicExampleWithService /></Tabs.Tab>
</Tabs>

[Link to this example](https://vovk-examples.vercel.app/basic-with-service)

